<app-header />

<div class="p-6">
  <div class="max-w-4xl mx-auto">
    
    <!-- Page Title -->
    <div class="mb-8">
      <h1 class="page-title">Личный кабинет</h1>
      <p class="text-[var(--text-secondary)]">Управляйте своим профилем и резюме</p>
    </div>

    <!-- Personal Info Card -->
    <div class="glass-card p-6 mb-6">
      <h2 class="section-title flex items-center gap-2">
        <mat-icon class="text-accent-500">person</mat-icon>
        Личная информация
      </h2>
      
      <form [formGroup]="userForm" (ngSubmit)="updateUser()" class="space-y-4">
        <div class="grid md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Имя</label>
            <input
              type="text"
              formControlName="firstName"
              class="glass-input"
              placeholder="Ваше имя"
            />
          </div>
          
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Фамилия</label>
            <input
              type="text"
              formControlName="lastName"
              class="glass-input"
              placeholder="Ваша фамилия"
            />
          </div>
        </div>

        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Телефон</label>
          <input
            type="tel"
            formControlName="phoneNumber"
            class="glass-input"
            placeholder="+375 29 123 45 67"
          />
        </div>

        <button type="submit" class="glass-btn py-3 px-6">
          Сохранить
        </button>
      </form>
    </div>

    <!-- Resume Section -->
    <div class="glass-card p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="section-title mb-0 flex items-center gap-2">
          <mat-icon class="text-accent-500">description</mat-icon>
          Резюме
        </h2>
        <button *ngIf="!isNewResume" (click)="goToResume()" class="glass-btn-secondary py-2 px-4 text-sm">
          <mat-icon class="text-sm mr-1">visibility</mat-icon>
          Посмотреть
        </button>
      </div>

      <!-- No Resume Alert -->
      <div *ngIf="isNewResume" class="glass-card-subtle p-4 border-l-4 border-warning-500 mb-6">
        <div class="flex items-start gap-3">
          <mat-icon class="text-warning-500 flex-shrink-0">info</mat-icon>
          <div>
            <h3 class="font-semibold text-[var(--text-primary)]">У вас пока нет резюме</h3>
            <p class="text-sm text-[var(--text-secondary)] mt-1">Заполните форму ниже, чтобы создать резюме</p>
          </div>
        </div>
      </div>

      <!-- Resume Description Form -->
      <form [formGroup]="resumeDescriptionForm" (ngSubmit)="onDesctiptionSubmit()" class="space-y-4">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Заголовок</label>
          <input
            type="text"
            formControlName="title"
            class="glass-input"
            placeholder="Например: Frontend Developer"
          />
        </div>

        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Описание</label>
          <textarea
            formControlName="summary"
            class="glass-textarea"
            placeholder="Расскажите о себе..."
            rows="4"
          ></textarea>
        </div>

        <!-- Skills -->
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Навыки</label>
            <button type="button" (click)="addSkill()" class="text-sm text-[var(--accent-primary)] hover:underline flex items-center gap-1">
              <mat-icon class="text-sm">add</mat-icon> Добавить
            </button>
          </div>
          <div formArrayName="skills" class="flex flex-wrap gap-2">
            <div 
              *ngFor="let skill of skills.controls; let i = index"
              [formGroupName]="i"
              class="flex items-center gap-2 glass-card-subtle px-3 py-2 rounded-xl"
            >
              <input
                formControlName="name"
                class="bg-transparent border-none outline-none text-sm w-24 text-[var(--text-primary)]"
                placeholder="Навык"
              />
              <button type="button" (click)="removeSkill(i)" class="text-[var(--text-muted)] hover:text-error-500">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Tags -->
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Теги</label>
            <button type="button" (click)="addTag()" class="text-sm text-[var(--accent-primary)] hover:underline flex items-center gap-1">
              <mat-icon class="text-sm">add</mat-icon> Добавить
            </button>
          </div>
          <div formArrayName="tags" class="flex flex-wrap gap-2">
            <div 
              *ngFor="let tag of tags.controls; let i = index"
              [formGroupName]="i"
              class="flex items-center gap-2 glass-card-subtle px-3 py-2 rounded-xl"
            >
              <input
                formControlName="name"
                class="bg-transparent border-none outline-none text-sm w-24 text-[var(--text-primary)]"
                placeholder="Тег"
              />
              <button type="button" (click)="removeTag(i)" class="text-[var(--text-muted)] hover:text-error-500">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <button type="submit" class="glass-btn py-3 px-6">
          {{ isNewResume ? 'Создать резюме' : 'Сохранить' }}
        </button>
      </form>
    </div>

    <!-- Additional Resume Sections (only if resume exists) -->
    <ng-container *ngIf="!isNewResume">
      <app-resume-language-form
        [resumeLanguages]="resume?.languages"
        [resumeId]="resume?.id"
      />

      <app-resume-certifications-form
        [resumeCertifications]="resume?.certifications"
        [resumeId]="resume?.id"
      />

      <app-resume-education-form
        [resumeEducations]="resume?.educations"
        [resumeId]="resume?.id"
      />

      <app-resume-projects-form
        [resumeProjects]="resume?.projects"
        [resumeId]="resume?.id"
      />

      <app-resume-experiences-form
        [resumeJobExperiences]="resume?.jobExperiences"
        [resumeId]="resume?.id"
      />
    </ng-container>
  </div>
</div>
