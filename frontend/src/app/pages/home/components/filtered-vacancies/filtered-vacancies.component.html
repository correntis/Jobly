<div class="flex flex-col lg:flex-row gap-6 p-6">
  <!-- Filters Sidebar -->
  <aside class="lg:w-80 flex-shrink-0">
    <div class="glass-card p-6 lg:sticky lg:top-24">
      <div class="flex items-center justify-between mb-6">
        <h2 class="section-title mb-0">Фильтры</h2>
        <button
          type="button"
          (click)="applyFilters()"
          class="glass-btn py-2 px-4 text-sm"
        >
          Применить
        </button>
      </div>

      <form [formGroup]="vacanciesFilterForm" class="space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar pr-2">
        <!-- Title Search -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Название вакансии</label>
          <input
            formControlName="title"
            class="glass-input text-sm py-2 w-full"
            placeholder="Поиск по названию..."
          />
        </div>

        <div class="glass-divider"></div>

        <!-- Requirements -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Требования</label>
          <div class="space-y-2">
            <div *ngFor="let ctrl of getFormArrayControls('requirements').controls; let i = index" class="flex gap-2">
              <app-searchable-select
                [control]="$any(ctrl).controls.name"
                [options]="requirementsOptions"
                [placeholder]="'Требование...'"
                [allowCustom]="true"
                class="flex-1"
              ></app-searchable-select>
              <button type="button" (click)="removeFromArray('requirements', i)" class="glass-btn-secondary p-2">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
          <button type="button" (click)="addToArray('requirements')" class="text-sm text-[var(--accent-primary)] hover:underline flex items-center gap-1">
            <mat-icon class="text-sm">add</mat-icon> Добавить
          </button>
        </div>

        <div class="glass-divider"></div>

        <!-- Skills -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Навыки</label>
          <div class="space-y-2">
            <div *ngFor="let ctrl of getFormArrayControls('skills').controls; let i = index" class="flex gap-2">
              <app-searchable-select
                [control]="$any(ctrl).controls.name"
                [options]="skillsOptions"
                [placeholder]="'Навык...'"
                [allowCustom]="true"
                class="flex-1"
              ></app-searchable-select>
              <button type="button" (click)="removeFromArray('skills', i)" class="glass-btn-secondary p-2">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
          <button type="button" (click)="addToArray('skills')" class="text-sm text-[var(--accent-primary)] hover:underline flex items-center gap-1">
            <mat-icon class="text-sm">add</mat-icon> Добавить
          </button>
        </div>

        <div class="glass-divider"></div>

        <!-- Technologies -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Технологии</label>
          <div class="space-y-2">
            <div *ngFor="let ctrl of getFormArrayControls('technologies').controls; let i = index" class="flex gap-2">
              <app-searchable-select
                [control]="$any(ctrl).controls.name"
                [options]="technologiesOptions"
                [placeholder]="'Технология...'"
                [allowCustom]="true"
                class="flex-1"
              ></app-searchable-select>
              <button type="button" (click)="removeFromArray('technologies', i)" class="glass-btn-secondary p-2">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
          <button type="button" (click)="addToArray('technologies')" class="text-sm text-[var(--accent-primary)] hover:underline flex items-center gap-1">
            <mat-icon class="text-sm">add</mat-icon> Добавить
          </button>
        </div>

        <div class="glass-divider"></div>

        <!-- Experience -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Опыт работы (лет)</label>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <input
                type="number"
                [formControl]="$any(experience).controls.min"
                class="glass-input text-sm py-2"
                placeholder="От"
              />
            </div>
            <div>
              <input
                type="number"
                [formControl]="$any(experience).controls.max"
                class="glass-input text-sm py-2"
                placeholder="До"
              />
            </div>
          </div>
        </div>

        <div class="glass-divider"></div>

        <!-- Salary -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Зарплата</label>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <input
                type="number"
                [formControl]="$any(salary).controls.min"
                class="glass-input text-sm py-2"
                placeholder="От"
              />
            </div>
            <div>
              <input
                type="number"
                [formControl]="$any(salary).controls.max"
                class="glass-input text-sm py-2"
                placeholder="До"
              />
            </div>
          </div>
          <select [formControl]="$any(salary).controls.currency" class="glass-select text-sm py-2">
            <option value="">Валюта</option>
            <option *ngFor="let currency of currencies" [value]="currency.code">
              {{ currency.code }} [{{ currency.symbolNative }}] ({{ currency.name }})
            </option>
          </select>
        </div>
      </form>
    </div>
  </aside>

  <!-- Vacancies Grid -->
  <main class="flex-1">
    <div class="mb-6">
      <h1 class="page-title">Вакансии</h1>
      <p class="text-[var(--text-secondary)]">Найдите работу вашей мечты</p>
    </div>

    <!-- Loader -->
    <app-loader *ngIf="isLoading && (!vacanciesList || vacanciesList.length === 0)" message="Загрузка вакансий..."></app-loader>

    <div *ngIf="!isLoading || (vacanciesList && vacanciesList.length > 0)" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
      <ng-container *ngFor="let vacancy of vacanciesList; let i = index">
        <app-compact-vacancy [vacancy]="vacancy"></app-compact-vacancy>
      </ng-container>
    </div>

    <!-- Load More Button -->
    <div *ngIf="vacanciesList && vacanciesList.length > 0 && !isFullLoaded" class="flex justify-center mt-8">
      <button
        (click)="searchVacancies()"
        class="glass-btn-secondary px-8 py-3 flex items-center gap-2"
      >
        <mat-icon>refresh</mat-icon>
        Загрузить ещё
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="vacanciesList?.length === 0" class="glass-card p-12 text-center">
      <mat-icon class="text-6xl text-[var(--text-muted)] mb-4">work_off</mat-icon>
      <h3 class="text-xl font-semibold text-[var(--text-primary)] mb-2">Вакансии не найдены</h3>
      <p class="text-[var(--text-secondary)]">Попробуйте изменить параметры поиска</p>
    </div>
  </main>
</div>
