<div class="flex flex-col align-middle items-center bg-gray-100">
  <div
    *ngIf="isForUser()"
    class="flex flex-col items-center justify-evenly bg-blue-700 w-[100%] py-2"
  >
    <div>
      <h2 class="text-3xl text-white">
        {{ chat?.application?.vacancy?.title }}
      </h2>
    </div>
    <div (click)="goToCompany()">
      <span
        class="text-blue-300 underline cursor-pointer hover:text-[15px] hover:text-blue-100"
      >
        View company details
      </span>
    </div>
  </div>

  <div
    *ngIf="isForCompany()"
    class="flex flex-col items-center justify-evenly bg-blue-700 w-[100%] py-2"
  >
    <div class="flex items-center gap-5">
      <div>
        <h2 class="text-3xl text-white">
          {{ user?.firstName }} {{ user?.lastName }}
        </h2>
      </div>

      <div
        *ngIf="chat?.application?.status === ApplicationStatus.Unread"
        class="flex gap-2"
      >
        <div
          (click)="updateStatus(ApplicationStatus.Rejected)"
          class="hover:scale-95 hover:cursor-pointer"
        >
          <span
            class="bg-red-800 text-white px-4 py-2 rounded-full text-sm font-semibold"
            >Reject</span
          >
        </div>
        <div
          (click)="updateStatus(ApplicationStatus.Accepted)"
          class="hover:scale-95 hover:cursor-pointer"
        >
          <span
            class="bg-green-800 text-white px-4 py-2 rounded-full text-sm font-semibold"
            >Accept</span
          >
        </div>
      </div>
    </div>
    <div (click)="goToResume()">
      <span
        class="text-blue-300 underline cursor-pointer hover:text-[15px] hover:text-blue-100"
      >
        View Resume
      </span>
    </div>
  </div>

  <div
    class="flex flex-col h-[92vh] rounded-lg p-4 w-[80%] min-w-[400px] max-w-[800px]"
  >
    <div
      class="flex flex-col-reverse flex-grow overflow-y-auto mb-4 pb-6 rounded-xl border border-gray-300 border-solid bg-gray-200"
      (scroll)="onScroll($event)"
      #scrollContainer
    >
      <div
        *ngFor="let message of messages; let i = index"
        class="relative"
        [ngClass]="{
          'bg-blue-300': showContextMenu && selectedMessageIndex === i
        }"
        id="message-{{ i }}"
      >
        <app-message
          [message]="message"
          [senderId]="currentSenderId"
          (contextmenu)="
            currentSenderId === message.senderId
              ? onRightClick($event, message, i)
              : undefined
          "
        />

        <app-message-context-menu
          *ngIf="showContextMenu && selectedMessageIndex === i"
          (edit)="onEditMessage()"
          (copy)="onCopyClick()"
        />
      </div>
    </div>

    <div>
      <app-simple-input-form
        *ngIf="!isEditing"
        (submit)="sendMessage($event)"
        placeHolder="Input message..."
        buttonText="Send"
      />

      <div *ngIf="isEditing">
        <div class="flex flex-row mb-2">
          <div class="w-full rounded-lg bg-blue-300 px-5 pt-3 pb-5">
            <p class="text-base leading-none font-semibold">
              Message:
              <span class="text-sm font-light">
                {{ selectedMessage?.content }}
              </span>
            </p>
          </div>
          <div
            class="bg-red-300 hover:bg-red-500 hover:cursor-pointer rounded-lg ml-2 px-5 flex items-center justify-center"
            (click)="cancelEditing()"
          >
            <mat-icon class="scale-125 font-light" matSuffix>close</mat-icon>
          </div>
        </div>

        <app-simple-input-form
          (submit)="submitEditMessage($event)"
          [input]="selectedMessage?.content || ''"
          placeHolder="Edit message..."
          buttonText="Edit"
        />
      </div>
    </div>
  </div>
</div>
