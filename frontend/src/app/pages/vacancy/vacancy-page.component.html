<app-header />

<div class="p-6">
  <div class="max-w-6xl mx-auto">
    <div *ngIf="vacancy" class="grid lg:grid-cols-3 gap-6">
      
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Header Card -->
        <div class="glass-card p-8">
          <!-- Archived Badge -->
          <div *ngIf="vacancy.archived" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-error-500/20 text-error-500 text-sm font-medium mb-4">
            <mat-icon class="text-lg">archive</mat-icon>
            Вакансия в архиве
          </div>

          <!-- Title -->
          <h1 class="text-3xl lg:text-4xl font-bold text-[var(--text-primary)] mb-4 font-display">
            {{ vacancy.title }}
          </h1>

          <!-- Salary -->
          <div *ngIf="vacancy.vacancyDetails?.salary" class="mb-6">
            <div class="text-3xl font-bold text-gradient">
              <ng-container *ngIf="vacancy.vacancyDetails?.salary?.original; else regularSalary">
                <span *ngIf="vacancy.vacancyDetails?.salary?.original?.min">
                  {{ vacancy.vacancyDetails?.salary?.original?.min | number:'1.0-0' }}
                </span>
                <span *ngIf="vacancy.vacancyDetails?.salary?.original?.max">
                  — {{ vacancy.vacancyDetails?.salary?.original?.max | number:'1.0-0' }}
                </span>
                <span class="text-xl font-medium text-[var(--text-secondary)] ml-2">
                  {{ vacancy.vacancyDetails?.salary?.original?.currency }}
                </span>
              </ng-container>
              <ng-template #regularSalary>
                <span *ngIf="vacancy.vacancyDetails?.salary?.min">
                  {{ vacancy.vacancyDetails?.salary?.min | number:'1.0-0' }}
                </span>
                <span *ngIf="vacancy.vacancyDetails?.salary?.max">
                  — {{ vacancy.vacancyDetails?.salary?.max | number:'1.0-0' }}
                </span>
                <span class="text-xl font-medium text-[var(--text-secondary)] ml-2">
                  {{ vacancy.vacancyDetails?.salary?.currency }}
                </span>
              </ng-template>
            </div>
          </div>

          <!-- Meta Info -->
          <div class="flex flex-wrap gap-3 mb-6">
            <div *ngIf="vacancy.vacancyDetails?.experience" class="glass-tag inline-flex items-center gap-1.5">
              <mat-icon class="text-sm">work_history</mat-icon>
              Опыт:<span *ngIf="vacancy.vacancyDetails?.experience?.min"> от {{ vacancy.vacancyDetails?.experience?.min }}</span><span *ngIf="vacancy.vacancyDetails?.experience?.max"> до {{ vacancy.vacancyDetails?.experience?.max }}</span> лет
            </div>
            <div class="glass-tag inline-flex items-center gap-1.5">
              <mat-icon class="text-sm">schedule</mat-icon>
              {{ vacancy.employmentType }}
            </div>
            <div class="glass-tag inline-flex items-center gap-1.5">
              <mat-icon class="text-sm">calendar_today</mat-icon>
              {{ vacancy.createdAt | date:'d MMMM yyyy' }}
            </div>
            <div class="glass-tag inline-flex items-center gap-1.5">
              <mat-icon class="text-sm">timer</mat-icon>
              Дедлайн: {{ vacancy.deadlineAt | date:'d MMMM yyyy' }}
            </div>
          </div>

          <!-- Interaction Buttons (for non-creators) -->
          <div *ngIf="!isUserCreator" class="flex gap-3 mb-6">
            <button
              (click)="onInteraction(InteractionType.Like)"
              class="flex items-center gap-2 px-4 py-2 rounded-xl transition-all"
              [class]="interaction?.type === InteractionType.Like 
                ? 'bg-success-500 text-white shadow-lg shadow-success-500/30' 
                : 'glass-card-subtle hover:bg-success-500/10 text-[var(--text-secondary)]'"
            >
              <mat-icon>thumb_up</mat-icon>
              <span>Нравится</span>
            </button>
            <button
              (click)="onInteraction(InteractionType.Dislike)"
              class="flex items-center gap-2 px-4 py-2 rounded-xl transition-all"
              [class]="interaction?.type === InteractionType.Dislike 
                ? 'bg-error-500 text-white shadow-lg shadow-error-500/30' 
                : 'glass-card-subtle hover:bg-error-500/10 text-[var(--text-secondary)]'"
            >
              <mat-icon>thumb_down</mat-icon>
              <span>Не интересно</span>
            </button>
          </div>

          <!-- Action Button or Already Applied Notice -->
          <div *ngIf="!isUserCreator && !vacancy.archived">
            <div *ngIf="alreadyApplied" class="glass-card-subtle p-4 border-l-4 border-warning-500 mb-4">
              <div class="flex items-center gap-2 text-warning-600 dark:text-warning-400 mb-3">
                <mat-icon>check_circle</mat-icon>
                <span class="font-medium">Вы уже откликнулись на эту вакансию</span>
              </div>
              <button (click)="goToApplication()" class="glass-btn-secondary w-full py-3 flex items-center justify-center gap-2">
                <mat-icon>chat</mat-icon>
                Перейти к отклику
              </button>
            </div>
            <button *ngIf="!alreadyApplied" (click)="apply()" class="glass-btn w-full py-4 text-lg">
              <mat-icon class="mr-2">send</mat-icon>
              Откликнуться
            </button>
          </div>

          <div *ngIf="isUserCreator && !vacancy.archived">
            <button (click)="archive()" class="glass-btn-danger w-full py-4 text-lg">
              <mat-icon class="mr-2">archive</mat-icon>
              В архив
            </button>
          </div>
        </div>

        <!-- Skills & Technologies -->
        <div *ngIf="vacancy.vacancyDetails" class="glass-card p-8">
          <!-- Skills -->
          <div *ngIf="vacancy.vacancyDetails.skills?.length" class="mb-8">
            <h2 class="section-title">Навыки</h2>
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let skill of vacancy.vacancyDetails.skills"
                class="px-4 py-2 rounded-xl text-sm font-medium bg-primary-500/10 text-primary-600 dark:bg-primary-400/20 dark:text-primary-300"
              >
                {{ skill }}
              </span>
            </div>
          </div>

          <!-- Technologies -->
          <div *ngIf="vacancy.vacancyDetails.technologies?.length" class="mb-8">
            <h2 class="section-title">Технологии</h2>
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let technology of vacancy.vacancyDetails.technologies"
                class="px-4 py-2 rounded-xl text-sm font-medium bg-accent-500/10 text-accent-600 dark:bg-accent-400/20 dark:text-accent-300"
              >
                {{ technology }}
              </span>
            </div>
          </div>

          <!-- Languages -->
          <div *ngIf="vacancy.vacancyDetails.languages?.length">
            <h2 class="section-title">Языки</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <div
                *ngFor="let language of vacancy.vacancyDetails.languages"
                class="glass-card-subtle p-4 text-center"
              >
                <div class="font-semibold text-[var(--text-primary)]">{{ language.name }}</div>
                <div class="text-sm text-[var(--text-secondary)]">{{ language.level }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Details Sections -->
        <div *ngIf="vacancy.vacancyDetails" class="glass-card p-8">
          <ng-container *ngFor="let category of getDetailsKeys()">
            <div *ngIf="hasDetails(category)" class="mb-8 last:mb-0">
              <h2 class="section-title capitalize">{{ getCategoryTitle(category) }}</h2>
              <ul class="space-y-2">
                <li 
                  *ngFor="let item of getDetails(category)"
                  class="flex items-start gap-3 text-[var(--text-secondary)]"
                >
                  <mat-icon class="text-accent-500 text-lg flex-shrink-0 mt-0.5">check_circle</mat-icon>
                  <span>{{ item }}</span>
                </li>
              </ul>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Company Card -->
        <div *ngIf="company" class="glass-card p-6 lg:sticky lg:top-24">
          <div class="text-center mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center mx-auto mb-3">
              <span class="text-white font-bold text-2xl">{{ company.name?.charAt(0) }}</span>
            </div>
            <h3 class="text-xl font-bold text-[var(--text-primary)]">{{ company.name }}</h3>
          </div>
          
          <div class="space-y-3 text-sm">
            <div *ngIf="company.email" class="flex items-center gap-3 text-[var(--text-secondary)]">
              <mat-icon class="text-lg">email</mat-icon>
              <span>{{ company.email }}</span>
            </div>
            <div *ngIf="company.phone" class="flex items-center gap-3 text-[var(--text-secondary)]">
              <mat-icon class="text-lg">phone</mat-icon>
              <span>{{ company.phone }}</span>
            </div>
          </div>

          <button 
            (click)="goToCompany(company.id)" 
            class="glass-btn-secondary w-full mt-6 py-3"
          >
            Подробнее о компании
          </button>
        </div>
      </div>
    </div>
  </div>
<div>