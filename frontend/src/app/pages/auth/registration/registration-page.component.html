<div class="min-h-screen flex items-center justify-center p-6 py-12">
  <div class="w-full max-w-lg">
    <!-- Logo -->
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-accent-500 shadow-glow mb-4">
        <span class="text-white font-bold text-3xl font-display">J</span>
      </div>
      <h1 class="text-3xl font-bold text-[var(--text-primary)] font-display">
        {{ step === 1 ? 'Создать аккаунт' : 'Создать компанию' }}
      </h1>
      <p class="text-[var(--text-secondary)] mt-2">
        {{ step === 1 ? 'Заполните данные для регистрации' : 'Расскажите о вашей компании' }}
      </p>
    </div>

    <!-- Step Indicator -->
    <div *ngIf="registrationForm.get('choosedRole')?.value === 'Company'" class="flex justify-center gap-3 mb-6">
      <div class="flex items-center gap-2">
        <div 
          class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all"
          [class]="step >= 1 ? 'bg-gradient-to-br from-primary-500 to-accent-500 text-white' : 'glass-card-subtle text-[var(--text-muted)]'"
        >1</div>
        <span class="text-sm text-[var(--text-secondary)]">Аккаунт</span>
      </div>
      <div class="w-12 h-0.5 self-center bg-[var(--border-color)]"></div>
      <div class="flex items-center gap-2">
        <div 
          class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all"
          [class]="step >= 2 ? 'bg-gradient-to-br from-primary-500 to-accent-500 text-white' : 'glass-card-subtle text-[var(--text-muted)]'"
        >2</div>
        <span class="text-sm text-[var(--text-secondary)]">Компания</span>
      </div>
    </div>

    <!-- Registration Form Step 1 -->
    <div *ngIf="step === 1" class="glass-card p-8">
      <form [formGroup]="registrationForm" (ngSubmit)="register()" class="space-y-4">
        <!-- Name Fields Row -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Имя</label>
            <input
              type="text"
              formControlName="firstName"
              class="glass-input"
              placeholder="Имя"
              [class.border-error-500]="registrationForm.get('firstName')?.touched && registrationForm.get('firstName')?.invalid"
            />
            <div *ngIf="registrationForm.get('firstName')?.touched && registrationForm.get('firstName')?.errors" class="text-error-500 text-xs">
              <span *ngIf="registrationForm.get('firstName')?.hasError('required')">Имя обязательно</span>
              <span *ngIf="registrationForm.get('firstName')?.hasError('serverError') && !registrationForm.get('firstName')?.hasError('required')">Некорректное имя</span>
            </div>
          </div>
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Фамилия</label>
            <input
              type="text"
              formControlName="lastName"
              class="glass-input"
              placeholder="Фамилия"
              [class.border-error-500]="registrationForm.get('lastName')?.touched && registrationForm.get('lastName')?.invalid"
            />
            <div *ngIf="registrationForm.get('lastName')?.touched && registrationForm.get('lastName')?.errors" class="text-error-500 text-xs">
              <span *ngIf="registrationForm.get('lastName')?.hasError('required')">Фамилия обязательна</span>
              <span *ngIf="registrationForm.get('lastName')?.hasError('serverError') && !registrationForm.get('lastName')?.hasError('required')">Некорректная фамилия</span>
            </div>
          </div>
        </div>

        <!-- Email Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Email</label>
          <input
            type="email"
            formControlName="email"
            class="glass-input"
            placeholder="Email"
            [class.border-error-500]="(registrationForm.get('email')?.touched || registrationForm.get('email')?.dirty) && registrationForm.get('email')?.invalid"
          />
          <div *ngIf="(registrationForm.get('email')?.touched || registrationForm.get('email')?.dirty) && registrationForm.get('email')?.errors" class="text-error-500 text-xs">
            <span *ngIf="registrationForm.get('email')?.hasError('existingEmail')">Email уже занят</span>
            <span *ngIf="registrationForm.get('email')?.hasError('email') && !registrationForm.get('email')?.hasError('existingEmail')">Некорректный email</span>
            <span *ngIf="registrationForm.get('email')?.hasError('required') && !registrationForm.get('email')?.hasError('existingEmail')">Email обязателен</span>
          </div>
        </div>

        <!-- Password Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Пароль</label>
          <div class="relative">
            <input
              [type]="hidePassword ? 'password' : 'text'"
              formControlName="password"
              class="glass-input pr-12"
              placeholder="Пароль"
              [class.border-error-500]="registrationForm.get('password')?.touched && registrationForm.get('password')?.invalid"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility()"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-[var(--text-muted)]"
            >
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
          </div>
          <div *ngIf="registrationForm.get('password')?.touched && registrationForm.get('password')?.errors" class="text-error-500 text-xs">
            <span *ngIf="registrationForm.get('password')?.hasError('required')">Пароль обязателен</span>
            <span *ngIf="registrationForm.get('password')?.hasError('minlength') && !registrationForm.get('password')?.hasError('required')">Пароль должен быть не менее 6 символов</span>
            <span *ngIf="registrationForm.get('password')?.hasError('pattern') && !registrationForm.get('password')?.hasError('required') && !registrationForm.get('password')?.hasError('minlength')">Пароль должен содержать заглавную букву, цифру и спецсимвол (!%&)</span>
            <span *ngIf="registrationForm.get('password')?.hasError('serverError') && !registrationForm.get('password')?.hasError('required') && !registrationForm.get('password')?.hasError('minlength') && !registrationForm.get('password')?.hasError('pattern')">Некорректный пароль</span>
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Подтверждение</label>
          <div class="relative">
            <input
              [type]="hideConfirmPassword ? 'password' : 'text'"
              formControlName="confirmPassword"
              class="glass-input pr-12"
              placeholder="Повторите пароль"
              [class.border-error-500]="registrationForm.get('confirmPassword')?.touched && registrationForm.get('confirmPassword')?.invalid"
            />
            <button
              type="button"
              (click)="toggleConfirmPasswordVisibility()"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-[var(--text-muted)]"
            >
              <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
          </div>
          <div *ngIf="registrationForm.get('confirmPassword')?.touched && registrationForm.get('confirmPassword')?.errors" class="text-error-500 text-xs">
            <span *ngIf="registrationForm.get('confirmPassword')?.hasError('required')">Подтверждение пароля обязательно</span>
            <span *ngIf="registrationForm.get('confirmPassword')?.hasError('mustMatch') && !registrationForm.get('confirmPassword')?.hasError('required')">Пароли не совпадают</span>
          </div>
        </div>

        <!-- Role Selection -->
        <div class="space-y-3">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Выберите роль</label>
          <div class="grid gap-3">
            <label
              *ngFor="let role of appRoles"
              class="glass-card-subtle p-4 cursor-pointer transition-all hover:border-primary-500"
              [class.border-primary-500]="registrationForm.get('choosedRole')?.value === role.roleName"
              [class.border-error-500]="registrationForm.get('choosedRole')?.touched && registrationForm.get('choosedRole')?.invalid"
              [class.shadow-glow]="registrationForm.get('choosedRole')?.value === role.roleName"
            >
              <input
                type="radio"
                formControlName="choosedRole"
                [value]="role.roleName"
                class="hidden"
              />
              <span class="text-[var(--text-primary)]">{{ role.text }}</span>
            </label>
          </div>
          <div *ngIf="registrationForm.get('choosedRole')?.touched && registrationForm.get('choosedRole')?.errors" class="text-error-500 text-xs">
            <span *ngIf="registrationForm.get('choosedRole')?.hasError('required')">Выберите роль</span>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="glass-btn w-full py-4 text-lg mt-6">
          {{ registrationForm.get('choosedRole')?.value === 'Company' ? 'Далее' : 'Зарегистрироваться' }}
        </button>

        <!-- Divider -->
        <div class="glass-divider"></div>

        <!-- Login Link -->
        <p class="text-center text-[var(--text-secondary)]">
          Уже есть аккаунт?
          <a routerLink="/login" class="text-accent-500 font-semibold hover:underline">
            Войти
          </a>
        </p>
      </form>
    </div>

    <!-- Company Form Step 2 -->
    <div *ngIf="step === 2" class="glass-card p-8">
      <form [formGroup]="companyForm" (ngSubmit)="register()" class="space-y-4">
        <!-- Company Name -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Название</label>
          <input
            type="text"
            formControlName="companyName"
            class="glass-input"
            placeholder="Компания"
            [class.border-error-500]="companyForm.get('companyName')?.touched && companyForm.get('companyName')?.invalid"
          />
          <div *ngIf="companyForm.get('companyName')?.touched && companyForm.get('companyName')?.errors" class="text-error-500 text-xs">
            <span *ngIf="companyForm.get('companyName')?.hasError('required')">Название компании обязательно</span>
            <span *ngIf="companyForm.get('companyName')?.hasError('serverError') && !companyForm.get('companyName')?.hasError('required')">Название компании обязательно</span>
          </div>
        </div>

        <!-- Company Type -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Тип</label>
          <input
            type="text"
            formControlName="companyType"
            class="glass-input"
            placeholder="IT, Финансы..."
            [class.border-error-500]="companyForm.get('companyType')?.touched && companyForm.get('companyType')?.invalid"
          />
          <div *ngIf="companyForm.get('companyType')?.touched && companyForm.get('companyType')?.errors" class="text-error-500 text-xs">
            <span *ngIf="companyForm.get('companyType')?.hasError('required')">Тип компании обязателен</span>
            <span *ngIf="companyForm.get('companyType')?.hasError('serverError') && !companyForm.get('companyType')?.hasError('required')">Тип компании обязателен</span>
          </div>
        </div>

        <!-- Company Email & Phone Row -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Email</label>
            <input
              type="email"
              formControlName="companyEmail"
              class="glass-input"
              placeholder="info@company.com"
              [class.border-error-500]="companyForm.get('companyEmail')?.touched && companyForm.get('companyEmail')?.invalid"
            />
            <div *ngIf="companyForm.get('companyEmail')?.touched && companyForm.get('companyEmail')?.errors" class="text-error-500 text-xs">
              <span *ngIf="companyForm.get('companyEmail')?.hasError('email')">Некорректный email</span>
              <span *ngIf="companyForm.get('companyEmail')?.hasError('serverError') && !companyForm.get('companyEmail')?.hasError('email')">Некорректный email</span>
            </div>
          </div>
          <div class="space-y-2">
            <label class="text-sm font-semibold text-[var(--text-primary)]">Телефон</label>
            <input
              type="tel"
              formControlName="companyPhone"
              class="glass-input"
              placeholder="+375 29 123 45 67"
              [class.border-error-500]="companyForm.get('companyPhone')?.touched && companyForm.get('companyPhone')?.invalid"
            />
            <div *ngIf="companyForm.get('companyPhone')?.touched && companyForm.get('companyPhone')?.errors" class="text-error-500 text-xs">
              <span *ngIf="companyForm.get('companyPhone')?.hasError('pattern')">Номер телефона должен состоять из 10 цифр</span>
              <span *ngIf="companyForm.get('companyPhone')?.hasError('serverError') && !companyForm.get('companyPhone')?.hasError('pattern')">Некорректный номер телефона</span>
            </div>
          </div>
        </div>

        <!-- City -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Город</label>
          <input
            type="text"
            formControlName="companyCity"
            class="glass-input"
            placeholder="Москва"
            [class.border-error-500]="companyForm.get('companyCity')?.touched && companyForm.get('companyCity')?.invalid"
          />
          <div *ngIf="companyForm.get('companyCity')?.touched && companyForm.get('companyCity')?.errors" class="text-error-500 text-xs">
            <span *ngIf="companyForm.get('companyCity')?.hasError('serverError')">Некорректное значение города</span>
          </div>
        </div>

        <!-- UNP -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">УНП</label>
          <input
            type="text"
            formControlName="companyUnp"
            class="glass-input"
            placeholder="193239702"
            maxlength="9"
            [class.border-error-500]="companyForm.get('companyUnp')?.touched && companyForm.get('companyUnp')?.invalid"
          />
          <div *ngIf="companyForm.get('companyUnp')?.touched && companyForm.get('companyUnp')?.errors" class="text-error-500 text-xs">
            <span *ngIf="companyForm.get('companyUnp')?.hasError('required')">УНП обязателен</span>
            <span *ngIf="companyForm.get('companyUnp')?.hasError('pattern') && !companyForm.get('companyUnp')?.hasError('required')">УНП должен состоять из 9 цифр</span>
            <span *ngIf="companyForm.get('companyUnp')?.hasError('invalidUnp') && !companyForm.get('companyUnp')?.hasError('required') && !companyForm.get('companyUnp')?.hasError('pattern')">
              Компания с таким УНП не найдена в ЕГР или не является действующей
            </span>
          </div>
          <p class="text-xs text-[var(--text-muted)]">Учетный номер плательщика (9 цифр)</p>
        </div>

        <!-- Description -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Описание</label>
          <textarea
            formControlName="companyDescription"
            class="glass-textarea"
            placeholder="О компании..."
            rows="3"
            [class.border-error-500]="companyForm.get('companyDescription')?.touched && companyForm.get('companyDescription')?.invalid"
          ></textarea>
          <div *ngIf="companyForm.get('companyDescription')?.touched && companyForm.get('companyDescription')?.errors" class="text-error-500 text-xs">
            <span *ngIf="companyForm.get('companyDescription')?.hasError('serverError')">Некорректное описание</span>
          </div>
        </div>

        <!-- Logo Upload -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-[var(--text-primary)]">Логотип</label>
          <label class="glass-card-subtle p-4 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500 transition-all">
            <mat-icon class="text-3xl text-[var(--text-muted)] mb-1">cloud_upload</mat-icon>
            <span class="text-sm text-[var(--text-secondary)]">Загрузить</span>
            <input
              type="file"
              (change)="onFileSelect($event)"
              class="hidden"
              accept="image/*"
            />
          </label>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 mt-6">
          <button
            type="button"
            (click)="backToFirstStep()"
            class="glass-btn-secondary flex-1 py-4"
          >
            Назад
          </button>
          <button type="submit" class="glass-btn flex-1 py-4">
            Завершить
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
